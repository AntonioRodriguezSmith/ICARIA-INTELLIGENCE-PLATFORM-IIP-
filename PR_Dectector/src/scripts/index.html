<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ICARIA Intelligence Platform - Análisis de casos Broker vs condiciones ICARIA">
    <meta name="author" content="Antonio Rodriguez Smith - DXC Technology">
    <meta name="confidential" content="Banco Sabadell S.A. - CONFIDENCIAL">
    
    <title>ICARIA Intelligence Platform v2.0.0 | Banco Sabadell</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/img/favicon.ico">
    
    <!-- Bootstrap 5.3+ CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" 
          rel="stylesheet" 
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" 
          crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" 
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css" 
          integrity="sha384-c9MVe88U+P7VE+5e8L9CPu2M5NnbF5zFO8wAoiN5fZNqXHZFJcMo6b1HLpK9YuE7" 
          crossorigin="anonymous">
    
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css">
    
    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header-principal">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1>
                        <i class="bi bi-graph-up-arrow"></i>
                        ICARIA Intelligence Platform
                    </h1>
                    <p class="mb-0">
                        <small>Banco Sabadell S.A. - Departamento TDM</small>
                    </p>
                </div>
                <div class="col-md-4 text-end">
                    <span class="version-badge me-2">v2.0.0</span>
                    <span class="confidencial-badge">CONFIDENCIAL</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Navegación Principal -->
    <div class="container-fluid mt-3">
        <ul class="nav nav-tabs" id="modulosTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="modulo1-tab" data-bs-toggle="tab" 
                        data-bs-target="#modulo1-detector" type="button" role="tab">
                    <i class="bi bi-search"></i>
                    <span class="d-none d-sm-inline">Detector de Condiciones</span>
                    <span class="d-inline d-sm-none">Detector</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link disabled" id="modulo2-tab" data-bs-toggle="tab" 
                        data-bs-target="#modulo2-chat" type="button" role="tab" disabled>
                    <i class="bi bi-chat-dots"></i>
                    <span class="d-none d-sm-inline">Chat IA</span>
                    <span class="d-inline d-sm-none">Chat</span>
                    <span class="badge bg-secondary ms-1">Fase 2</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="modulo3-tab" data-bs-toggle="tab" 
                        data-bs-target="#modulo3-validador" type="button" role="tab">
                    <i class="bi bi-pencil-square"></i>
                    <span class="d-none d-sm-inline">Validador de Texto</span>
                    <span class="d-inline d-sm-none">Validador</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="modulo4-tab" data-bs-toggle="tab" 
                        data-bs-target="#modulo4-arquetipos" type="button" role="tab">
                    <i class="bi bi-bookmark"></i>
                    <span class="d-none d-sm-inline">Arquetipos</span>
                    <span class="d-inline d-sm-none">Arquetipos</span>
                </button>
            </li>
        </ul>

        <!-- Contenido de Módulos -->
        <div class="tab-content p-4" id="modulosTabContent">
            
            <!-- MÓDULO 1: DETECTOR DE CONDICIONES -->
            <div class="tab-pane fade show active" id="modulo1-detector" role="tabpanel">
                <div class="row">
                    <div class="col-12">
                        <h2>
                            <i class="bi bi-search text-primary"></i>
                            Detector de Condiciones
                        </h2>
                        <p class="text-muted">
                            Analiza casos Broker contra condiciones ICARIA modeladas
                        </p>
                        <hr>
                    </div>
                </div>

                <!-- Sección de carga de archivos -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-file-earmark-text"></i>
                                Casos Broker (.md)
                            </div>
                            <div class="card-body">
                                <div class="file-upload-area">
                                    <i class="bi bi-cloud-upload"></i>
                                    <p class="mb-2"><strong>Arrastre aquí o haga clic</strong></p>
                                    <input type="file" class="form-control" id="input-casos-broker" 
                                           accept=".md,.txt">
                                    <small class="text-muted">Formatos: .md, .txt (Máx. 5MB)</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-file-earmark-check"></i>
                                Condiciones ICARIA (.txt)
                            </div>
                            <div class="card-body">
                                <div class="file-upload-area">
                                    <i class="bi bi-cloud-upload"></i>
                                    <p class="mb-2"><strong>Arrastre aquí o haga clic</strong></p>
                                    <input type="file" class="form-control" id="input-condiciones-icaria" 
                                           accept=".txt">
                                    <small class="text-muted">Formatos: .txt (Máx. 5MB)</small>
                                </div>
                                <div class="alert alert-info mt-2">
                                    <small><i class="bi bi-info-circle"></i> Opcional - Si no se carga, se usará el catálogo predefinido (5 condiciones)</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Estado de carga -->
                <div class="row mb-3">
                    <div class="col-12">
                        <div id="estado-carga"></div>
                    </div>
                </div>

                <!-- Botones de acción -->
                <div class="row mb-4">
                    <div class="col-12 text-center">
                        <button class="btn btn-primary btn-lg" id="btn-analizar" disabled>
                            <i class="bi bi-play-circle-fill"></i>
                            Ejecutar Análisis
                        </button>
                        <button class="btn btn-secondary btn-lg" id="btn-limpiar">
                            <i class="bi bi-arrow-clockwise"></i>
                            Limpiar
                        </button>
                    </div>
                </div>

                <!-- Spinner de carga -->
                <div id="spinner-analisis" class="spinner-container" style="display: none;">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Analizando...</span>
                    </div>
                    <span class="ms-3">Procesando análisis...</span>
                </div>

                <!-- Resultados -->
                <div id="seccion-resultados" style="display: none;">
                    <!-- Métricas Dashboard -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card metric-card">
                                <div class="card-body text-center">
                                    <div class="metric-value" id="metrica-total-casos">0</div>
                                    <div class="metric-label">Total Casos</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card metric-card">
                                <div class="card-body text-center">
                                    <div class="metric-value" id="metrica-cobertura">0%</div>
                                    <div class="metric-label">Cobertura Promedio</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="card metric-card border-success">
                                <div class="card-body text-center">
                                    <small class="text-success" id="metrica-modelados">0 (0%)</small>
                                    <div class="metric-label">Modelada</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="card metric-card border-warning">
                                <div class="card-body text-center">
                                    <small class="text-warning" id="metrica-parciales">0 (0%)</small>
                                    <div class="metric-label">Parcial</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="card metric-card border-danger">
                                <div class="card-body text-center">
                                    <small class="text-danger" id="metrica-no-modelados">0 (0%)</small>
                                    <div class="metric-label">No Modelada</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabla de resultados -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-table"></i>
                                    Resultados del Análisis
                                </div>
                                <div class="card-body">
                                    <table id="tabla-resultados" class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th>ID Caso</th>
                                                <th>Descripción</th>
                                                <th>Estado</th>
                                                <th>Scoring</th>
                                                <th>Condiciones</th>
                                                <th>Confianza</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Gráficos -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-pie-chart"></i>
                                    Distribución de Estados
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="grafico-distribucion"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <i class="bi bi-bar-chart"></i>
                                    Top 5 Condiciones Más Frecuentes
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="grafico-condiciones"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Botones de exportación -->
                    <div class="row mb-4">
                        <div class="col-12 text-center">
                            <button class="btn btn-success" id="btn-export-md">
                                <i class="bi bi-file-earmark-code"></i>
                                Exportar Markdown
                            </button>
                            <button class="btn btn-danger" id="btn-export-pdf">
                                <i class="bi bi-file-earmark-pdf"></i>
                                Exportar PDF
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MÓDULO 2: CHAT IA (Preparado para Fase 2) -->
            <div class="tab-pane fade" id="modulo2-chat" role="tabpanel">
                <div class="row">
                    <div class="col-12 text-center py-5">
                        <i class="bi bi-robot" style="font-size: 4rem; color: var(--sabadell-azul-claro);"></i>
                        <h3 class="mt-3">Chat IA</h3>
                        <p class="text-muted">Esta funcionalidad estará disponible en la Fase 2</p>
                        <div class="alert alert-info d-inline-block">
                            <i class="bi bi-info-circle"></i>
                            Integración con LLM (OpenAI/Groq) planificada
                        </div>
                    </div>
                </div>
            </div>

            <!-- MÓDULO 3: VALIDADOR DE TEXTO INDIVIDUAL -->
            <div class="tab-pane fade" id="modulo3-validador" role="tabpanel">
                <div class="row">
                    <div class="col-12">
                        <h2>
                            <i class="bi bi-pencil-square text-primary"></i>
                            Validador de Texto Individual
                        </h2>
                        <p class="text-muted">
                            Valide texto libre contra el catálogo de condiciones ICARIA
                        </p>
                        <hr>
                    </div>
                </div>

                <!-- Info del catálogo -->
                <div class="row mb-3">
                    <div class="col-12">
                        <div id="catalogo-condiciones-info"></div>
                    </div>
                </div>

                <!-- Input de texto -->
                <div class="row mb-4">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-keyboard"></i>
                                Ingrese el texto a validar
                            </div>
                            <div class="card-body">
                                <textarea class="form-control" id="validador-input-texto" 
                                          rows="6" 
                                          placeholder="Ingrese aquí la descripción de la condición que desea buscar...&#10;&#10;Ejemplo: 'La divisa de la operación debe ser EUR'"></textarea>
                                <div id="sugerencias-validador" class="mt-2"></div>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-primary" id="btn-validar-texto">
                                    <i class="bi bi-search"></i>
                                    Buscar
                                </button>
                                <button class="btn btn-secondary" id="btn-limpiar-validador">
                                    <i class="bi bi-x-circle"></i>
                                    Limpiar
                                </button>
                                <button class="btn btn-success" id="btn-crear-arquetipo-desde-validador" 
                                        style="display: none;">
                                    <i class="bi bi-bookmark-plus"></i>
                                    Crear Arquetipo
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div id="scoring-validacion"></div>
                    </div>
                </div>

                <!-- Resultados de validación -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <i class="bi bi-list-check"></i>
                                Resultados de la Búsqueda
                            </div>
                            <div class="card-body">
                                <div id="resultados-validacion">
                                    <div class="alert alert-secondary">
                                        <i class="bi bi-search"></i>
                                        Ingrese un texto para buscar condiciones similares
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MÓDULO 4: ARQUETIPOS -->
            <div class="tab-pane fade" id="modulo4-arquetipos" role="tabpanel">
                <div class="row">
                    <div class="col-12">
                        <h2>
                            <i class="bi bi-bookmark text-primary"></i>
                            Gestión de Arquetipos
                        </h2>
                        <p class="text-muted">
                            Cree y administre arquetipos de condiciones para aplicar a múltiples casos
                        </p>
                        <hr>
                    </div>
                </div>

                <!-- Biblioteca predefinida -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h4>
                            <i class="bi bi-star-fill text-warning"></i>
                            Arquetipos Predefinidos
                        </h4>
                        <p class="text-muted small">Arquetipos listos para usar (Q48, Q49, Q63)</p>
                        <div id="biblioteca-predefinida"></div>
                    </div>
                </div>

                <hr class="my-4">

                <!-- Arquetipos personalizados -->
                <div class="row mb-3">
                    <div class="col-12 d-flex justify-content-between align-items-center">
                        <h4>
                            <i class="bi bi-bookmark-fill text-primary"></i>
                            Mis Arquetipos
                        </h4>
                        <button class="btn btn-primary" id="btn-crear-arquetipo">
                            <i class="bi bi-plus-circle"></i>
                            Crear Nuevo Arquetipo
                        </button>
                    </div>
                </div>

                <!-- Formulario crear arquetipo -->
                <div id="formulario-arquetipo" class="mb-4" style="display: none;">
                    <div class="card border-primary">
                        <div class="card-header bg-primary text-white">
                            <i class="bi bi-plus-circle"></i>
                            Nuevo Arquetipo
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="arquetipo-nombre" class="form-label">Nombre del Arquetipo *</label>
                                <input type="text" class="form-control" id="arquetipo-nombre" 
                                       placeholder="Ej: Arquetipo Q70">
                            </div>
                            <div class="mb-3">
                                <label for="arquetipo-descripcion" class="form-label">Descripción</label>
                                <textarea class="form-control" id="arquetipo-descripcion" rows="2" 
                                          placeholder="Descripción opcional del arquetipo"></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Condiciones a Incluir *</label>
                                <div id="condiciones-disponibles"></div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-success" id="btn-guardar-arquetipo">
                                <i class="bi bi-save"></i>
                                Guardar Arquetipo
                            </button>
                            <button class="btn btn-secondary" id="btn-cancelar-arquetipo">
                                <i class="bi bi-x-circle"></i>
                                Cancelar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Lista de arquetipos -->
                <div class="row">
                    <div class="col-12">
                        <div id="lista-arquetipos"></div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Footer -->
    <footer class="footer-principal">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-4">
                    <h5>ICARIA Intelligence Platform</h5>
                    <p class="small">
                        Versión 2.0.0<br>
                        © 2026 DXC Technology
                    </p>
                </div>
                <div class="col-md-4">
                    <h6>Cliente</h6>
                    <p class="small">
                        Banco Sabadell S.A.<br>
                        Departamento TDM<br>
                        Responsable: Manuel Gil
                    </p>
                </div>
                <div class="col-md-4">
                    <h6>Proveedor</h6>
                    <p class="small">
                        DXC Technology<br>
                        Desarrollador: Antonio Rodriguez Smith<br>
                        Agente IA: Cipher
                    </p>
                </div>
            </div>
            <hr class="border-light">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="small mb-0">
                        <i class="bi bi-shield-lock"></i>
                        <strong>CONFIDENCIAL</strong> - Este proyecto contiene información de Banco Sabadell S.A.
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Toast Container para notificaciones -->
    <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>

    <!-- jQuery (requerido por DataTables) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" 
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" 
            crossorigin="anonymous"></script>
    
    <!-- Bootstrap 5 Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" 
            integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" 
            crossorigin="anonymous"></script>
    
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" 
            integrity="sha384-rdqz+4qy8b5BdZMZjT3+vQZCOmLuW9x4R6H0DIQj5rDNmLrz9KU8zGUHJQOGKQHP" 
            crossorigin="anonymous"></script>
    
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" 
            integrity="sha512-qZvrmS2ekKPF2mSznTQsxqPgnpkI4DNTlrdUmTzrDgektczlKNRRhy5X5AAOnx5S09ydFYWWNSfcEqDTTHgtNA==" 
            crossorigin="anonymous" 
            referrerpolicy="no-referrer"></script>
    
    <!-- Scripts de la aplicación -->
    <script src="js/config/constantes.js"></script>
    <script src="js/utilidades/helpers.js"></script>
    <script src="js/core/motor-matching.js"></script>
    <script src="js/modulos/detector-condiciones.js"></script>
    <script src="js/modulos/validador-texto.js"></script>
    <script src="js/modulos/arquetipos.js"></script>
    
    <!-- Script de inicialización -->
    <script>
        // Log de inicialización
        console.log('%c ICARIA Intelligence Platform v2.0.0 ', 
                    'background: #0072CE; color: white; font-size: 16px; font-weight: bold; padding: 5px;');
        console.log('© 2026 DXC Technology - Banco Sabadell S.A.');
        console.log('CONFIDENCIAL - Información protegida');
        
        // Verificar que todas las dependencias se cargaron
        document.addEventListener('DOMContentLoaded', function() {
            log('Aplicación ICARIA iniciada correctamente', 'info');
            
            // Verificar dependencias
            const dependencias = {
                'jQuery': typeof $ !== 'undefined',
                'Bootstrap': typeof bootstrap !== 'undefined',
                'DataTables': typeof $.fn.DataTable !== 'undefined',
                'Chart.js': typeof Chart !== 'undefined',
                'jsPDF': typeof window.jspdf !== 'undefined'
            };
            
            let todasCargadas = true;
            for (const [nombre, cargada] of Object.entries(dependencias)) {
                if (!cargada) {
                    console.error(`❌ ${nombre} no se cargó correctamente`);
                    todasCargadas = false;
                } else {
                    log(`✓ ${nombre} cargado`, 'debug');
                }
            }
            
            if (todasCargadas) {
                log('Todas las dependencias cargadas correctamente', 'info');
            } else {
                console.error('⚠️ Algunas dependencias no se cargaron. La aplicación puede no funcionar correctamente.');
            }
        });
    </script>
</body>
</html>
